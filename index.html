<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeminiSwap - The Ultimate Token Swap</title>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* A simple font and smooth transitions for a better UI feel */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #f8fafc; /* Slate 50 */
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 1.5rem;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary {
            transition: all 0.2s ease-in-out;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.5);
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 max-w-7xl">
        <header class="flex justify-between items-center py-4">
            <h1 class="text-3xl font-bold text-indigo-400">GeminiSwap üíé</h1>
            <div class="flex items-center space-x-4">
                <button id="select-network-btn" class="bg-slate-700/80 px-4 py-2 rounded-xl font-semibold hover:bg-slate-600/80 transition-colors">
                    <span id="network-name">Ethereum</span>
                </button>
                <button id="connect-wallet-btn" class="bg-indigo-600 px-4 py-2 rounded-xl font-bold btn-primary">Connect Wallet</button>
                <div id="user-profile" class="hidden items-center space-x-3 bg-slate-700/80 pl-4 pr-2 py-1.5 rounded-xl">
                    <span id="wallet-address" class="text-sm font-mono"></span>
                    <button id="disconnect-btn" class="text-red-400 hover:text-red-300 text-sm font-bold">X</button>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
            <div class="lg:col-span-1">
                <div class="glass-card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Swap</h2>
                        <button class="text-slate-400 hover:text-white">‚öôÔ∏è</button> </div>
                    <div class="bg-slate-900/70 p-4 rounded-xl mb-1 relative">
                        <label class="text-xs text-slate-400">From</label>
                        <div class="flex justify-between items-end mt-1">
                            <input id="from-amount" type="number" placeholder="0.0" class="bg-transparent text-3xl w-full focus:outline-none appearance-none">
                            <button class="flex items-center bg-slate-800 p-2 rounded-xl font-semibold hover:bg-slate-700 min-w-[120px] justify-between">
                                <img src="https://assets.coingecko.com/coins/images/279/small/ethereum.png" class="w-6 h-6 rounded-full" alt="ETH icon">
                                <span class="ml-2">ETH</span> 
                                <span class="ml-1">‚ñº</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-center my-2">
                        <button class="bg-slate-700 p-2 rounded-full hover:bg-slate-600 rotate-90 transition-transform">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                              <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="bg-slate-900/70 p-4 rounded-xl">
                        <label class="text-xs text-slate-400">To</label>
                        <div class="flex justify-between items-end mt-1">
                            <input id="to-amount" type="number" placeholder="0.0" class="bg-transparent text-3xl w-full focus:outline-none appearance-none" readonly>
                            <button class="flex items-center bg-indigo-600 p-2 rounded-xl font-semibold hover:bg-indigo-500 min-w-[120px] justify-between">
                                <span class="ml-2">Select</span> 
                                <span class="ml-1">‚ñº</span>
                            </button>
                        </div>
                    </div>
                    <div id="swap-details" class="text-sm text-slate-400 mt-4 space-y-2 hidden">
                        <div class="flex justify-between"><span>Price</span><span id="price-info">1 ETH = 2,950 USDC</span></div>
                        <div class="flex justify-between"><span>Slippage</span><span>0.5%</span></div>
                        <div class="flex justify-between"><span>Network Fee</span><span id="network-fee">~$1.25</span></div>
                    </div>
                    <button id="swap-btn" class="w-full bg-indigo-600 mt-6 py-4 rounded-2xl text-xl font-bold btn-primary disabled:bg-slate-700 disabled:cursor-not-allowed disabled:shadow-none" disabled>Connect Wallet</button>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="glass-card p-6 mb-8">
                    <div id="chart-info" class="flex items-center mb-4">
                        <img id="chart-token-icon" src="https://assets.coingecko.com/coins/images/279/large/ethereum.png" class="w-8 h-8 mr-3" alt="token icon">
                        <div>
                            <h3 id="chart-token-name" class="text-xl font-bold">Ethereum (ETH)</h3>
                            <p id="chart-token-price" class="text-2xl font-semibold text-green-400">$2,980.50</p>
                        </div>
                    </div>
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="glass-card p-6">
                    <h3 class="text-lg font-bold mb-4">Recent Transactions</h3>
                    <div id="tx-history-list" class="space-y-3">
                        <p class="text-slate-500">Connect wallet to view transaction history.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- STATE MANAGEMENT ---
    let provider;
    let signer;
    let userAddress;
    let priceChart;

    // --- UI ELEMENTS ---
    const connectWalletBtn = document.getElementById('connect-wallet-btn');
    const disconnectBtn = document.getElementById('disconnect-btn');
    const userProfileDiv = document.getElementById('user-profile');
    const walletAddressSpan = document.getElementById('wallet-address');
    const swapBtn = document.getElementById('swap-btn');
    const txHistoryList = document.getElementById('tx-history-list');
    const fromAmountInput = document.getElementById('from-amount');
    const toAmountInput = document.getElementById('to-amount');
    const swapDetailsDiv = document.getElementById('swap-details');
    
    // --- WEB3 & WALLET FUNCTIONS ---

    // Function to connect wallet
    const connectWallet = async () => {
        if (typeof window.ethereum !== 'undefined') {
            try {
                // Use Ethers.js to wrap the browser provider
                provider = new ethers.providers.Web3Provider(window.ethereum);
                // Request account access
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                updateUIForConnectedState(userAddress);
                fetchTransactionHistory(userAddress);

            } catch (error) {
                console.error("User rejected connection:", error);
                alert("Connection failed. Please try again.");
            }
        } else {
            alert('Please install a wallet like MetaMask!');
        }
    };

    // Function to disconnect wallet
    const disconnectWallet = () => {
        provider = null;
        signer = null;
        userAddress = null;
        updateUIForDisconnectedState();
    };

    // --- UI UPDATE FUNCTIONS ---

    // Update UI when wallet is connected
    const updateUIForConnectedState = (address) => {
        connectWalletBtn.classList.add('hidden');
        userProfileDiv.classList.remove('hidden');
        walletAddressSpan.textContent = `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
        swapBtn.textContent = 'Swap';
        swapBtn.disabled = false;
    };
    
    // Update UI when wallet is disconnected
    const updateUIForDisconnectedState = () => {
        connectWalletBtn.classList.remove('hidden');
        userProfileDiv.classList.add('hidden');
        walletAddressSpan.textContent = '';
        swapBtn.textContent = 'Connect Wallet';
        swapBtn.disabled = true;
        txHistoryList.innerHTML = '<p class="text-slate-500">Connect wallet to view transaction history.</p>';
        fromAmountInput.value = '';
        toAmountInput.value = '';
        swapDetailsDiv.classList.add('hidden');
    };

    // --- API & DATA FUNCTIONS ---

    // Function to fetch price chart data from CoinGecko API
    const fetchAndDisplayChart = async (tokenId = 'ethereum', vsCurrency = 'usd', days = '1') => {
        try {
            const apiUrl = `https://api.coingecko.com/api/v3/coins/${tokenId}/market_chart?vs_currency=${vsCurrency}&days=${days}`;
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            
            const prices = data.prices;
            const chartLabels = prices.map(p => new Date(p[0]).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
            const chartData = prices.map(p => p[1]);
            
            // Update token price info
            const currentPrice = chartData[chartData.length - 1];
            document.getElementById('chart-token-price').textContent = `$${currentPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            // Create or update chart
            const ctx = document.getElementById('priceChart').getContext('2d');
            if(priceChart) {
                priceChart.destroy();
            }
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: `Price (${vsCurrency.toUpperCase()})`,
                        data: chartData,
                        borderColor: chartData[0] <= currentPrice ? 'rgb(52, 211, 153)' : 'rgb(248, 113, 113)',
                        backgroundColor: 'rgba(52, 211, 153, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        } catch (error) {
            console.error("Failed to fetch chart data:", error);
            document.getElementById('priceChart').textContent = "Could not load chart data.";
        }
    };
    
    // MOCK Function to simulate getting swap quotes
    const getSwapQuote = () => {
        const amount = parseFloat(fromAmountInput.value);
        if (isNaN(amount) || amount <= 0) {
            toAmountInput.value = '';
            swapDetailsDiv.classList.add('hidden');
            return;
        }
        
        // Mock price rate and calculation
        const mockRate = 2950.75; // 1 ETH = 2950.75 USDC
        const outputAmount = amount * mockRate;
        toAmountInput.value = outputAmount.toFixed(4);
        swapDetailsDiv.classList.remove('hidden');
    };

    // MOCK Function to display transaction history
    const fetchTransactionHistory = (address) => {
        txHistoryList.innerHTML = ''; // Clear existing list
        const mockHistory = [
            { type: 'Swap', from: '0.5 ETH', to: '1475 USDC', status: '‚úÖ Completed' },
            { type: 'Swap', from: '100 USDT', to: '0.033 ETH', status: '‚úÖ Completed' },
            { type: 'Approval', token: 'USDC', status: '‚úÖ Completed' }
        ];
        
        if (mockHistory.length === 0) {
             txHistoryList.innerHTML = '<p class="text-slate-500">No recent transactions found.</p>';
             return;
        }

        mockHistory.forEach(tx => {
            const txElement = document.createElement('div');
            txElement.className = 'flex justify-between items-center bg-slate-800/50 p-3 rounded-lg';
            txElement.innerHTML = `
                <div>
                    <p class="font-semibold">${tx.type === 'Swap' ? `Swap ${tx.from} for ${tx.to}` : `${tx.type} ${tx.token}`}</p>
                    <p class="text-xs text-slate-400">${new Date().toLocaleDateString()}</p>
                </div>
                <span class="text-sm font-semibold text-green-400">${tx.status}</span>
            `;
            txHistoryList.appendChild(txElement);
        });
    };


    // --- EVENT LISTENERS ---
    connectWalletBtn.addEventListener('click', connectWallet);
    disconnectBtn.addEventListener('click', disconnectWallet);
    fromAmountInput.addEventListener('input', getSwapQuote);

    // --- INITIALIZATION ---
    fetchAndDisplayChart('ethereum'); // Load Ethereum chart by default
});
</script>

</body>
</html>