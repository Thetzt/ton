<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMM Panel - Just Another Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .service-card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }
        .api-key-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .api-key-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Navigation -->
    <nav class="glass-effect text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-rocket text-2xl"></i>
                <h1 class="text-2xl font-bold">SMM Panel Pro</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-wallet"></i>
                    <span id="balance">$0.00</span>
                </div>
                <button onclick="checkBalance()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </nav>

    
  <script>
        // API Configuration
        const API_CONFIG = {
            url: 'https://justanotherpanel.com/api/v2',
            key: '7590d2173f1e2fe1ef245261a99aa5bf' // ← Replace with your actual key
        };
    </script>

    
    <!-- API Configuration Section -->
    <div class="container mx-auto mt-8 px-4">
        <div class="glass-effect rounded-xl p-6 mb-8">
            <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-key mr-2"></i> API Configuration
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="text-white block mb-2">API Key</label>
                    <input type="password" id="apiKey" class="api-key-input w-full px-4 py-3 rounded-lg" 
                           placeholder="Enter your Just Another Panel API key">
                    <p class="text-sm text-gray-300 mt-2">
                        <i class="fas fa-info-circle"></i> Get your API key from Just Another Panel dashboard
                    </p>
                </div>
                <div class="flex items-end">
                    <button onclick="saveApiKey()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors w-full">
                        <i class="fas fa-save mr-2"></i> Save & Test Connection
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="grid md:grid-cols-4 gap-4 mb-8">
            <div class="glass-effect rounded-xl p-6 text-center">
                <i class="fas fa-shopping-cart text-3xl text-blue-300 mb-2"></i>
                <h3 class="text-white text-lg font-semibold">Total Orders</h3>
                <p class="text-2xl font-bold text-white" id="totalOrders">0</p>
            </div>
            <div class="glass-effect rounded-xl p-6 text-center">
                <i class="fas fa-dollar-sign text-3xl text-green-300 mb-2"></i>
                <h3 class="text-white text-lg font-semibold">Total Spent</h3>
                <p class="text-2xl font-bold text-white" id="totalSpent">$0.00</p>
            </div>
            <div class="glass-effect rounded-xl p-6 text-center">
                <i class="fas fa-clock text-3xl text-yellow-300 mb-2"></i>
                <h3 class="text-white text-lg font-semibold">Pending Orders</h3>
                <p class="text-2xl font-bold text-white" id="pendingOrders">0</p>
            </div>
            <div class="glass-effect rounded-xl p-6 text-center">
                <i class="fas fa-check-circle text-3xl text-purple-300 mb-2"></i>
                <h3 class="text-white text-lg font-semibold">Completed</h3>
                <p class="text-2xl font-bold text-white" id="completedOrders">0</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Service Selection -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-xl p-6 mb-8">
                    <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-list mr-2"></i> Select Platform
                    </h2>
                    <div class="grid md:grid-cols-3 gap-4 mb-6">
                        <button onclick="selectPlatform('tiktok')" class="platform-btn bg-black text-white p-4 rounded-lg hover:bg-gray-800 transition-colors service-card">
                            <i class="fab fa-tiktok text-2xl mb-2"></i>
                            <div>TikTok</div>
                        </button>
                        <button onclick="selectPlatform('instagram')" class="platform-btn bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg hover:opacity-90 transition-opacity service-card">
                            <i class="fab fa-instagram text-2xl mb-2"></i>
                            <div>Instagram</div>
                        </button>
                        <button onclick="selectPlatform('twitter')" class="platform-btn bg-blue-500 text-white p-4 rounded-lg hover:bg-blue-600 transition-colors service-card">
                            <i class="fab fa-twitter text-2xl mb-2"></i>
                            <div>Twitter</div>
                        </button>
                        <button onclick="selectPlatform('telegram')" class="platform-btn bg-blue-400 text-white p-4 rounded-lg hover:bg-blue-500 transition-colors service-card">
                            <i class="fab fa-telegram text-2xl mb-2"></i>
                            <div>Telegram</div>
                        </button>
                        <button onclick="selectPlatform('youtube')" class="platform-btn bg-red-500 text-white p-4 rounded-lg hover:bg-red-600 transition-colors service-card">
                            <i class="fab fa-youtube text-2xl mb-2"></i>
                            <div>YouTube</div>
                        </button>
                        <button onclick="selectPlatform('facebook')" class="platform-btn bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors service-card">
                            <i class="fab fa-facebook text-2xl mb-2"></i>
                            <div>Facebook</div>
                        </button>
                    </div>
                </div>

                <!-- Available Services -->
                <div class="glass-effect rounded-xl p-6 mb-8">
                    <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-cogs mr-2"></i> Available Services
                        <span id="loadingServices" class="ml-2 hidden">
                            <i class="fas fa-spinner loading"></i>
                        </span>
                    </h2>
                    <div id="servicesContainer" class="space-y-3">
                        <p class="text-gray-300">Select a platform to view available services</p>
                    </div>
                </div>

                <!-- Place Order -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-plus-circle mr-2"></i> Place Order
                    </h2>
                    <form id="orderForm" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-white block mb-2">Service</label>
                                <select id="selectedService" class="w-full px-4 py-3 rounded-lg bg-white">
                                    <option value="">Select a service</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-white block mb-2">Link/URL</label>
                                <input type="url" id="orderLink" class="w-full px-4 py-3 rounded-lg" 
                                       placeholder="https://tiktok.com/@username" required>
                            </div>
                        </div>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="text-white block mb-2">Quantity</label>
                                <input type="number" id="orderQuantity" class="w-full px-4 py-3 rounded-lg" 
                                       placeholder="1000" min="1" required>
                            </div>
                            <div>
                                <label class="text-white block mb-2">Runs (Optional)</label>
                                <input type="number" id="orderRuns" class="w-full px-4 py-3 rounded-lg" 
                                       placeholder="Leave empty">
                            </div>
                            <div>
                                <label class="text-white block mb-2">Interval (Minutes)</label>
                                <input type="number" id="orderInterval" class="w-full px-4 py-3 rounded-lg" 
                                       placeholder="Leave empty">
                            </div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="font-semibold">Estimated Cost:</span>
                                <span id="estimatedCost" class="text-xl font-bold text-blue-600">$0.00</span>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg transition-colors">
                            <i class="fas fa-shopping-cart mr-2"></i> Place Order
                        </button>
                    </form>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Order Status Check -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-search mr-2"></i> Check Order Status
                    </h2>
                    <div class="space-y-4">
                        <input type="text" id="orderIdCheck" class="w-full px-4 py-3 rounded-lg" 
                               placeholder="Enter Order ID">
                        <button onclick="checkOrderStatus()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg transition-colors">
                            <i class="fas fa-search mr-2"></i> Check Status
                        </button>
                        <div id="orderStatusResult" class="hidden bg-white p-4 rounded-lg">
                            <div id="statusContent"></div>
                        </div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-history mr-2"></i> Recent Orders
                    </h2>
                    <div id="recentOrders" class="space-y-3">
                        <p class="text-gray-300">No recent orders</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="glass-effect rounded-xl p-6">
                    <h2 class="text-white text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-bolt mr-2"></i> Quick Actions
                    </h2>
                    <div class="space-y-3">
                        <button onclick="loadServices()" class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i> Refresh Services
                        </button>
                        <button onclick="exportOrders()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-download mr-2"></i> Export Orders
                        </button>
                        <button onclick="clearHistory()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-trash mr-2"></i> Clear History
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl text-center">
            <i class="fas fa-spinner loading text-3xl text-blue-500 mb-4"></i>
            <p class="text-lg font-semibold">Processing...</p>
        </div>
    </div>

    <script>
        // ===== API CONFIGURATION =====
        // IMPORTANT: Replace this with your actual API key from Just Another Panel
        let API_KEY = localStorage.getItem('jap_api_key') || '';
        const API_URL = 'https://justanotherpanel.com/api/v2';
        
        // Global variables
        let services = [];
        let selectedPlatform = '';
        let orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved API key
            if (API_KEY) {
                document.getElementById('apiKey').value = API_KEY;
                checkBalance();
                loadServices();
            }
            
            // Load order history
            updateDashboard();
            displayRecentOrders();
            
            // Setup form validation
            setupFormValidation();
        });

        // ===== API KEY MANAGEMENT =====
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showToast('Please enter an API key', 'error');
                return;
            }
            
            API_KEY = apiKey;
            localStorage.setItem('jap_api_key', API_KEY);
            showToast('API key saved successfully', 'success');
            
            // Test the connection
            checkBalance();
            loadServices();
        }

        // ===== API FUNCTIONS =====
        async function makeApiRequest(data) {
            if (!API_KEY) {
                throw new Error('API key is required. Please configure your API key first.');
            }

            const formData = new FormData();
            formData.append('key', API_KEY);
            
            for (const key in data) {
                formData.append(key, data[key]);
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                return result;
            } catch (error) {
                console.error('API Request Error:', error);
                throw error;
            }
        }

        // ===== BALANCE CHECK =====
        async function checkBalance() {
            if (!API_KEY) {
                showToast('Please configure your API key first', 'warning');
                return;
            }

            try {
                const result = await makeApiRequest({ action: 'balance' });
                const balance = parseFloat(result.balance || 0).toFixed(2);
                document.getElementById('balance').textContent = `$${balance}`;
                showToast('Balance updated successfully', 'success');
            } catch (error) {
                console.error('Balance check error:', error);
                showToast(`Balance check failed: ${error.message}`, 'error');
                document.getElementById('balance').textContent = 'Error';
            }
        }

        // ===== SERVICE MANAGEMENT =====
        async function loadServices() {
            if (!API_KEY) {
                showToast('Please configure your API key first', 'warning');
                return;
            }

            const loadingElement = document.getElementById('loadingServices');
            loadingElement.classList.remove('hidden');

            try {
                const result = await makeApiRequest({ action: 'services' });
                services = result || [];
                populateServiceSelect();
                showToast(`Loaded ${services.length} services`, 'success');
            } catch (error) {
                console.error('Load services error:', error);
                showToast(`Failed to load services: ${error.message}`, 'error');
                services = [];
            } finally {
                loadingElement.classList.add('hidden');
            }
        }

        function selectPlatform(platform) {
            selectedPlatform = platform;
            
            // Update UI
            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-white', 'ring-opacity-50');
            });
            event.target.closest('.platform-btn').classList.add('ring-4', 'ring-white', 'ring-opacity-50');
            
            displayServicesForPlatform(platform);
        }

        function displayServicesForPlatform(platform) {
            const container = document.getElementById('servicesContainer');
            const platformServices = services.filter(service => 
                service.category.toLowerCase().includes(platform) || 
                service.name.toLowerCase().includes(platform)
            );

            if (platformServices.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-exclamation-circle text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-300">No services available for ${platform.charAt(0).toUpperCase() + platform.slice(1)}</p>
                        <p class="text-sm text-gray-400 mt-2">Try loading services or check your API connection</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = platformServices.map(service => `
                <div class="bg-white bg-opacity-10 p-4 rounded-lg hover:bg-opacity-20 transition-all cursor-pointer service-card"
                     onclick="selectService(${service.service})">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-white font-semibold">${service.name}</h3>
                            <p class="text-gray-300 text-sm">${service.category}</p>
                            <p class="text-xs text-gray-400 mt-1">
                                Min: ${service.min} | Max: ${service.max}
                                ${service.refill ? ' | Refill Available' : ''}
                            </p>
                        </div>
                        <div class="text-right">
                            <span class="text-green-300 font-bold">$${service.rate}</span>
                            <p class="text-xs text-gray-400">per 1000</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function populateServiceSelect() {
            const select = document.getElementById('selectedService');
            select.innerHTML = '<option value="">Select a service</option>';
            
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.service;
                option.textContent = `${service.name} - $${service.rate}/1k`;
                option.setAttribute('data-rate', service.rate);
                option.setAttribute('data-min', service.min);
                option.setAttribute('data-max', service.max);
                select.appendChild(option);
            });
        }

        function selectService(serviceId) {
            const select = document.getElementById('selectedService');
            select.value = serviceId;
            calculateCost();
            
            // Scroll to order form
            document.getElementById('orderForm').scrollIntoView({ behavior: 'smooth' });
        }

        // ===== ORDER MANAGEMENT =====
        function setupFormValidation() {
            const quantityInput = document.getElementById('orderQuantity');
            const serviceSelect = document.getElementById('selectedService');
            
            [quantityInput, serviceSelect].forEach(element => {
                element.addEventListener('change', calculateCost);
                element.addEventListener('input', calculateCost);
            });

            document.getElementById('orderForm').addEventListener('submit', placeOrder);
        }

        function calculateCost() {
            const serviceSelect = document.getElementById('selectedService');
            const quantity = parseInt(document.getElementById('orderQuantity').value) || 0;
            
            if (!serviceSelect.value || !quantity) {
                document.getElementById('estimatedCost').textContent = '$0.00';
                return;
            }
            
            const rate = parseFloat(serviceSelect.selectedOptions[0]?.getAttribute('data-rate')) || 0;
            const cost = (rate * quantity / 1000).toFixed(2);
            document.getElementById('estimatedCost').textContent = `$${cost}`;
        }

        async function placeOrder(event) {
            event.preventDefault();
            
            const serviceId = document.getElementById('selectedService').value;
            const link = document.getElementById('orderLink').value;
            const quantity = document.getElementById('orderQuantity').value;
            const runs = document.getElementById('orderRuns').value;
            const interval = document.getElementById('orderInterval').value;
            
            if (!serviceId || !link || !quantity) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            showLoadingOverlay(true);
            
            try {
                const orderData = {
                    action: 'add',
                    service: serviceId,
                    link: link,
                    quantity: quantity
                };
                
                if (runs) orderData.runs = runs;
                if (interval) orderData.interval = interval;
                
                const result = await makeApiRequest(orderData);
                
                if (result.order) {
                    const order = {
                        id: result.order,
                        service: serviceId,
                        link: link,
                        quantity: quantity,
                        timestamp: new Date().toISOString(),
                        status: 'Pending'
                    };
                    
                    orderHistory.unshift(order);
                    localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
                    
                    showToast(`Order placed successfully! Order ID: ${result.order}`, 'success');
                    document.getElementById('orderForm').reset();
                    document.getElementById('estimatedCost').textContent = '$0.00';
                    
                    updateDashboard();
                    displayRecentOrders();
                    checkBalance(); // Refresh balance
                } else {
                    throw new Error('Invalid response from server');
                }
            } catch (error) {
                console.error('Place order error:', error);
                showToast(`Order failed: ${error.message}`, 'error');
            } finally {
                showLoadingOverlay(false);
            }
        }

        // ===== ORDER STATUS =====
        async function checkOrderStatus() {
            const orderId = document.getElementById('orderIdCheck').value.trim();
            if (!orderId) {
                showToast('Please enter an order ID', 'error');
                return;
            }

            try {
                const result = await makeApiRequest({
                    action: 'status',
                    order: orderId
                });
                
                displayOrderStatus(result, orderId);
            } catch (error) {
                console.error('Check order status error:', error);
                showToast(`Status check failed: ${error.message}`, 'error');
            }
        }

        function displayOrderStatus(status, orderId) {
            const resultDiv = document.getElementById('orderStatusResult');
            const contentDiv = document.getElementById('statusContent');
            
            let statusColor = 'bg-blue-100 text-blue-800';
            if (status.status === 'Completed') statusColor = 'bg-green-100 text-green-800';
            else if (status.status === 'Cancelled') statusColor = 'bg-red-100 text-red-800';
            else if (status.status === 'In progress') statusColor = 'bg-yellow-100 text-yellow-800';
            
            contentDiv.innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Order ID:</span>
                        <span class="text-blue-600">#${orderId}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Status:</span>
                        <span class="px-2 py-1 rounded-full text-xs ${statusColor}">${status.status}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Charge:</span>
                        <span>$${parseFloat(status.charge || 0).toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Start Count:</span>
                        <span>${status.start_count || 'N/A'}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Remains:</span>
                        <span>${status.remains || 'N/A'}</span>
                    </div>
                </div>
            `;
            
            resultDiv.classList.remove('hidden');
            resultDiv.classList.add('fade-in');
        }

        // ===== DASHBOARD FUNCTIONS =====
        function updateDashboard() {
            const totalOrders = orderHistory.length;
            const totalSpent = orderHistory.reduce((sum, order) => {
                const service = services.find(s => s.service == order.service);
                const rate = service ? parseFloat(service.rate) : 0;
                return sum + (rate * order.quantity / 1000);
            }, 0);
            
            const pendingOrders = orderHistory.filter(order => 
                order.status === 'Pending' || order.status === 'In progress'
            ).length;
            
            const completedOrders = orderHistory.filter(order => 
                order.status === 'Completed'
            ).length;
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalSpent').textContent = `$${totalSpent.toFixed(2)}`;
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('completedOrders').textContent = completedOrders;
        }

        function displayRecentOrders() {
            const container = document.getElementById('recentOrders');
            const recentOrders = orderHistory.slice(0, 5);
            
            if (recentOrders.length === 0) {
                container.innerHTML = '<p class="text-gray-300">No recent orders</p>';
                return;
            }
            
            container.innerHTML = recentOrders.map(order => {
                const service = services.find(s => s.service == order.service);
                const serviceName = service ? service.name : `Service #${order.service}`;
                
                return `
                    <div class="bg-white bg-opacity-10 p-3 rounded-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-white font-semibold text-sm">${serviceName}</p>
                                <p class="text-gray-300 text-xs">Qty: ${order.quantity}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-blue-300 text-xs">#${order.id}</p>
                                <p class="text-xs text-gray-400">${new Date(order.timestamp).toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== UTILITY FUNCTIONS =====
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            }[type];
            
            const icon = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            }[type];
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 fade-in`;
            toast.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-4 hover:opacity-70">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function showLoadingOverlay(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        function exportOrders() {
            if (orderHistory.length === 0) {
                showToast('No orders to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(orderHistory, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'smm_orders_export.json';
            link.click();
            URL.revokeObjectURL(url);
            
            showToast('Orders exported successfully', 'success');
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all order history? This action cannot be undone.')) {
                orderHistory = [];
                localStorage.removeItem('orderHistory');
                updateDashboard();
                displayRecentOrders();
                showToast('Order history cleared', 'success');
            }
        }

        // ===== AUTO-REFRESH FUNCTIONS =====
        setInterval(() => {
            if (API_KEY && document.visibilityState === 'visible') {
                checkBalance();
            }
        }, 300000); // Refresh balance every 5 minutes
    </script>
</body>
</html>
