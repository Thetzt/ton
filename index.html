<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="24ea946052fe140b61dbe21ef569fc38438b6cf1" content="24ea946052fe140b61dbe21ef569fc38438b6cf1">
    <title>Premium MON Faucet</title>
    <style>
        /* Previous styles remain, add these new ones */
        
        .giveaway-box {
            width: 22%;
            height: 100px;
            background: linear-gradient(135deg, #FFD700 0%, #D4AF37 50%, #FFD700 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8B4513;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            border: 2px solid #D4AF37;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .giveaway-box::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255,255,255,0) 45%,
                rgba(255,255,255,0.8) 50%,
                rgba(255,255,255,0) 55%
            );
            transform: rotate(30deg);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }
        
        .notification-dot {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            background-color: #ff0000;
            border-radius: 50%;
            display: none;
        }
        
        .giveaway-box.claimed {
            background: linear-gradient(135deg, #cccccc 0%, #999999 100%);
            color: #666666;
            cursor: not-allowed;
        }
        
        .giveaway-box.claimed::before {
            display: none;
        }
        
        .claimed-label {
            position: absolute;
            bottom: 5px;
            font-size: 10px;
            color: #ff0000;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Previous HTML remains the same until giveaway boxes -->
    
    <div class="giveaway-container" id="giveaway-boxes">
        <div class="giveaway-box" onclick="claimBox(0)">
            <div class="notification-dot"></div>
            <span>游꾸</span>
            <div class="claimed-label"></div>
        </div>
        <div class="giveaway-box" onclick="claimBox(1)">
            <div class="notification-dot"></div>
            <span>游꾸</span>
            <div class="claimed-label"></div>
        </div>
        <div class="giveaway-box" onclick="claimBox(2)">
            <div class="notification-dot"></div>
            <span>游꾸</span>
            <div class="claimed-label"></div>
        </div>
        <div class="giveaway-box" onclick="claimBox(3)">
            <div class="notification-dot"></div>
            <span>游꾸</span>
            <div class="claimed-label"></div>
        </div>
    </div>

    <script>
        // Add these variables to track claimed status
        const claimedByOthers = [false, false, false, false];
        let lastClaimCheck = 0;
        
        // Add to DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            updateBoxes();
            startCooldownTimers();
            checkClaimedStatus(); // Initial check
            setInterval(checkClaimedStatus, 30000); // Check every 30 seconds
        });
        
        // New function to check if rewards were claimed by others
        function checkClaimedStatus() {
            const now = Date.now();
            if (now - lastClaimCheck < 30000) return; // 30 second cooldown
            
            lastClaimCheck = now;
            
            // Simulate API call to check claimed status
            // In a real implementation, this would be a fetch() to your backend
            setTimeout(() => {
                // Randomly mark 1-2 boxes as claimed by others (for demo)
                const boxesToClaim = Math.floor(Math.random() * 2) + 1;
                const availableBoxes = [0,1,2,3].filter(i => !claimedByOthers[i]);
                
                for (let i = 0; i < boxesToClaim && availableBoxes.length > 0; i++) {
                    const randomIndex = Math.floor(Math.random() * availableBoxes.length);
                    const boxIndex = availableBoxes[randomIndex];
                    claimedByOthers[boxIndex] = true;
                    availableBoxes.splice(randomIndex, 1);
                }
                
                updateBoxNotificationDots();
            }, 1000);
        }
        
        // Update notification dots
        function updateBoxNotificationDots() {
            boxes.forEach((box, index) => {
                const dot = box.querySelector('.notification-dot');
                const claimedLabel = box.querySelector('.claimed-label');
                
                if (claimedByOthers[index]) {
                    box.classList.add('claimed');
                    claimedLabel.textContent = 'CLAIMED';
                    dot.style.display = 'none';
                } else {
                    // Show dot if box is available but wasn't checked recently
                    const now = new Date();
                    if (userData.boxCooldowns[index]) {
                        const tenSecondsAgo = new Date(now.getTime() - 10 * 1000);
                        dot.style.display = userData.boxCooldowns[index] > tenSecondsAgo ? 'none' : 'block';
                    } else {
                        dot.style.display = 'block';
                    }
                }
            });
        }
        
        // Modified claimBox function
        function claimBox(boxIndex) {
            if (claimedByOthers[boxIndex]) {
                showMessage("This reward was already claimed by another user!", false);
                return;
            }
            
            const now = new Date();
            
            // Check if all boxes were claimed recently
            if (userData.boxesClaimed >= 4 && userData.lastFullClaim) {
                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                if (userData.lastFullClaim > oneHourAgo) {
                    showMessage("Please wait 1 hour after claiming all boxes", false);
                    return;
                } else {
                    // Reset if cooldown expired
                    userData.boxesClaimed = 0;
                }
            }
            
            // Check if this box is on cooldown
            if (userData.boxCooldowns[boxIndex]) {
                const tenSecondsAgo = new Date(now.getTime() - 10 * 1000);
                if (userData.boxCooldowns[boxIndex] > tenSecondsAgo) {
                    showMessage("Please wait 10 seconds between box claims", false);
                    return;
                }
            }
            
            // Show ad before claiming (30% chance)
            if (Math.random() < 0.3) {
                showFullscreenAd();
            }
            
            // Claim the box
            userData.balance += 0.0005;
            userData.boxesClaimed++;
            userData.boxCooldowns[boxIndex] = now;
            
            if (userData.boxesClaimed >= 4) {
                userData.lastFullClaim = now;
            }
            
            updateBalance();
            saveUserData();
            updateBoxes();
            
            showMessage(`+0.0005 MON claimed from box ${boxIndex + 1}! Total: ${userData.balance.toFixed(6)} MON`, true);
            
            // Start cooldown timer for this box
            startBoxCooldown(boxIndex);
        }
        
        // Modified updateBoxes function
        function updateBoxes() {
            const now = new Date();
            
            boxes.forEach((box, index) => {
                // Reset basic box styles
                box.classList.remove('disabled');
                box.innerHTML = '<div class="notification-dot"></div><span>游꾸</span><div class="claimed-label"></div>';
                
                // Check if claimed by others
                if (claimedByOthers[index]) {
                    box.classList.add('claimed');
                    box.querySelector('.claimed-label').textContent = 'CLAIMED';
                    box.querySelector('.notification-dot').style.display = 'none';
                    return;
                }
                
                // Check if on cooldown
                if (userData.boxCooldowns[index]) {
                    const tenSecondsAgo = new Date(now.getTime() - 10 * 1000);
                    if (userData.boxCooldowns[index] > tenSecondsAgo) {
                        box.classList.add('disabled');
                        const overlay = document.createElement('div');
                        overlay.className = 'cooldown-overlay';
                        const secondsLeft = Math.ceil((userData.boxCooldowns[index] - tenSecondsAgo) / 1000);
                        overlay.textContent = `${secondsLeft}s`;
                        box.appendChild(overlay);
                    }
                }
                
                // Update notification dot
                updateBoxNotificationDots();
            });
            
            // Check if all boxes are claimed
            if (userData.boxesClaimed >= 4 && userData.lastFullClaim) {
                const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);
                if (userData.lastFullClaim > oneHourAgo) {
                    boxes.forEach(box => {
                        box.classList.add('disabled');
                    });
                } else {
                    // Reset if cooldown expired
                    userData.boxesClaimed = 0;
                    saveUserData();
                }
            }
        }
    </script>
</body>
</html>